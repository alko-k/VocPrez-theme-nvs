{% extends "page.html" %}
{% set c = {
    "A": "#FFCECE",
    "B": "#FFF7B7",
    "C": "#D1FFB3",
    "D": "#74138C",
    "E": "#C0F7FE",
    "F": "#1F88A7",
    "G": "#4A9586",
    "H": "#D1D17A",
    "I": "#C27E3A",
    "L": "#FF800D",
    "M": "#7CEB98",
    "N": "#B4D1B6",
    "O": "#6FFF44",
    "P": "#FFFF84",
    "Q": "#5757FF",
    "R": "#63E9FC",
    "S": "#B5FFC8",
    "T": "#BD5CFE",
    "V": "#BD5CFE",
    "W": "#44B4D5",
   }
%}
{% block content %}
  <h1>Search</h1>

    <style>
      #search-options {
          display:grid;
          grid-template-rows: 30px 30px 30px 30px;
          grid-row-gap: 5px;

          height:140px;
          width: 75%;
      }

      a.search-option  {
        color: white;
        display: block;
        background: rgb(53, 80, 119) url({{ url_for('static', filename='icon-arrow-right-white-thick.svg') }}) right no-repeat;
        background-size: 25px;
        border: solid 1px rgb(73, 100, 139);
        padding:5px 10px 5px 10px;
        cursor: pointer;
      }

      a.search-option:hover {
        background-color: rgba(53, 80, 119, 0.5);
        text-decoration: none;
      }

      .sel {
          background-color: rgba(53, 80, 119, 0.75)!important;
      }

      #collection-ids-table {
         border-collapse: collapse;
         border:none;
      }

      #collection-ids-table td {
         border:none;
         text-align: center;
         vertical-align: middle;
      }

      .collection-id-cell div,
      .collection-id-cell-adv div{
          height:20px;
          width:35px;
          font-size: smaller;
          margin: 2px;
          cursor: pointer;
      }

      #search-form-advanced,
      #search-form-simple-within,
      #search-form-advanced-within {
          display: none;
      }
    </style>
    <div id="search-options">
      <a class="search-option" id="so-simple" style="grid-row:1;"> Simple search for vocabularies</a>
      <a class="search-option sel" id="so-advanced" style="grid-row:2;"> Advanced search for vocabularies</a>
      <a class="search-option" id="so-simple-within" style="grid-row:3;"> Simple search within a vocabulary</a>
      <a class="search-option" id="so-advanced-within" style="grid-row:4;"> Advanced search within a vocabulary</a>
    </div>

    <div id="search-form">
      <div id="search-form-simple" style="display:grid; grid-template-columns: 15% 85%; grid-template-rows: 50px 50px 50px;">
        <p style="grid-row:1; grid-column:1/3; font-style:italic;">Click search button with empty search text to get list of all available collections</p>
        <label style="grid-row:2; grid-column:1; font-weight:bold;" for="search-form-simple-text">Search text</label>
        <div style="grid-row:2; grid-column:2;">
          <input id="search-form-simple-text" type="text" style="border:none; background-color: #eee; width:300px; height:20px;"/>
        </div>
        <div style="grid-row:3; grid-column:2;"><input id="search-form-simple-submit" type="submit" value="Search" /></div>
      </div>
      <div id="search-form-advanced" style="display:grid; grid-template-columns: 15% 85%; grid-template-rows: 50px 50px 50px 40px 40px 40px 40px 40px 40px 40px 40px 40px 40px 40px 40px;">
        <p style="grid-row:1; grid-column:1/3; font-style:italic;">Click search button with empty search text to get list of all available collections</p>
        <label style="grid-row:2; grid-column:1; font-weight:bold;" for="search-form-advanced-text">Search text</label>
        <div style="grid-row:2; grid-column:2;">
          <input id="search-form-advanced-text" type="text" style="border:none; background-color: #eee; width:300px; height:20px;"/>
        </div>
        <div style="grid-row:3; grid-column:2;"><input id="search-form-advanced-submit" type="submit" value="Search" /></div>
        <div style="grid-row:4; grid-column:1;">
          <input type="checkbox" id="case-sensitive" name="case-sensitive" value="case-sensitive">
        </div>
        <div style="grid-row:4; grid-column:2;">
          <label for="case-sensitive">Case Sensitive</label>
        </div>
        <div style="grid-row:5; grid-column:1;">
          <input type="checkbox" id="exact-match" name="exact-match" value="exact-match">
        </div>
        <div style="grid-row:5; grid-column:2;">
          <label for="exact-match">Exact match</label>
        </div>
        <div style="grid-row:6; grid-column:1;">
          <input type="checkbox" id="identifier" name="identifier" value="identifier">
        </div>
        <div style="grid-row:6; grid-column:2;">
          <label for="identifier">Identifier</label>
        </div>
        <div style="grid-row:7; grid-column:1;">
          <input type="checkbox" id="pref-label" name="pref-label" value="pref-label">
        </div>
        <div style="grid-row:7; grid-column:2;">
          <label for="pref-label">Preferred label/Title</label>
        </div>
        <div style="grid-row:8; grid-column:1;">
          <input type="checkbox" id="alt-label" name="alt-label" value="alt-label">
        </div>
        <div style="grid-row:8; grid-column:2;">
          <label for="alt-label">Alternative label</label>
        </div>
        <div style="grid-row:9; grid-column:1;">
          <input type="checkbox" id="definition" name="definition" value="definition">
        </div>
        <div style="grid-row:9; grid-column:2;">
          <label for="definition">Description/Definition</label>
        </div>
        <div style="grid-row:10; grid-column:1/3;">
          <strong>Type selection</strong>
        </div>
        <div style="grid-row:11; grid-column:1;">
          <input type="radio" id="search-type-1" name="search-type" value="catalogue">
        </div>
        <div style="grid-row:11; grid-column:2;">
          <label for="search-type-1">Searching by catalogue</label>
        </div>
        <div style="grid-row:12; grid-column:1;">
          <input type="radio" id="search-type-2" name="search-type" value="concepts" checked>
        </div>
        <div style="grid-row:12; grid-column:2;">
          <label for="search-type-2">Searching by concepts</label>
        </div>
        <div style="grid-row:13; grid-column:1;">
          <label for="per-page-adv">
Results per page</label>
        </div>
        <div style="grid-row:13; grid-column:2;">
          <select name="per-page-adv">
            <option id="ten" value="10">10</option>
            <option id="fifty" value="50" selected>50</option>
            <option id="hundred" value="100">100</option>
            <option id="2hundred" value="200">200</option>
            <option id="5hundred" value="500">500</option>
          </select>
        </div>
      </div>
      <div id="search-form-simple-within" style="display:grid; grid-template-columns: 15% 85%; grid-template-rows: 50px 50px 50px 50px auto;">
        <p style="grid-row:1; grid-column:1/3; font-style:italic;">Click search button with empty search string to get list of all available concepts</p>
        <label style="grid-row:2; grid-column:1; font-weight:bold;" for="search-form-simple-text">Search text</label>
        <div style="grid-row:2; grid-column:2;">
          <input id="search-form-simple-text" type="text" style="border:none; background-color: #eee; width:300px; height:20px;"/>
        </div>
        <label style="grid-row:3; grid-column:1; font-weight:bold;" for="search-form-simple-text-collection">Collection ID</label>
        <div style="grid-row:3; grid-column:2;">
          <input id="search-form-simple-text-collection" type="text" style="border:none; background-color: #eee; width:150px; height:20px;"/>
        </div>
        <div style="grid-row:4; grid-column:2;"><input id="search-form-simple-submit" type="submit" value="Search" /></div>
        <div style="grid-row:5; grid-column:1/3;">
          <p><strong>Collections library</strong></p>
          <table id="collection-ids-table">
            <tr>
            {% for vocab in vocabs %}
              {%  if (loop.index - 1) % 15 == 0 %}
            </tr>
            <tr>
              {% endif %}
              <td class="collection-id-cell"><div style="background-color: {{ c[vocab[0][0]] }};" value="{{ vocab[0] }}" title="{{ vocab[1] }}">{{ vocab[0] }}</div></td>
            {% endfor %}
            </tr>
          </table>
        </div>
      </div>
      <div id="search-form-advanced-within" style="display:grid; grid-template-columns: 15% 85%; grid-template-rows: 50px 50px 50px 50px 50px 50px 100px 50px 50px 50px auto;">
        <p style="grid-row:1; grid-column:1/3; font-style:italic;">Click search button with empty search string to get list of all available concepts</p>
        <label style="grid-row:2; grid-column:1; font-weight:bold;" for="search-form-simple-text">Search text</label>
        <div style="grid-row:2; grid-column:2;">
          <input id="search-form-simple-text" type="text" style="border:none; background-color: #eee; width:300px; height:20px;"/>
        </div>
        <label style="grid-row:3; grid-column:1; font-weight:bold;" for="search-form-advanced-text-collection">Collection ID</label>
        <div style="grid-row:3; grid-column:2;">
          <input id="search-form-advanced-text-collection" type="text" style="border:none; background-color: #eee; width:150px; height:20px;"/>
        </div>
        <div style="grid-row:4; grid-column:2;"><input id="search-form-simple-submit" type="submit" value="Search" /></div>

        <div style="grid-row:5; grid-column:1;">
          <input type="checkbox" id="case-sensitive" name="case-sensitive" value="case-sensitive">
        </div>
        <div style="grid-row:5; grid-column:2;">
          <label for="case-sensitive">Case sensitive</label>
        </div>
        <div style="grid-row:6; grid-column:1;">
          <input type="checkbox" id="exact-match" name="exact-match" value="exact-match">
        </div>
        <div style="grid-row:6; grid-column:2;">
          <label for="exact-match">Exact match</label>
        </div>
        <div style="grid-row:7; grid-column:1;">
          Target inclusion
        </div>
        <div style="grid-row:7; grid-column:2;">
          <input type="checkbox" id="ti-identifier" name="ti-identifier" value="ti-identifier"><label for="ti-identifier">Identifier</label><br />
          <input type="checkbox" id="ti-pref-label" name="ti-pref-label" value="ti-pref-label"><label for="ti-pref-label">Preferred label</label><br />
          <input type="checkbox" id="ti-alt-label" name="ti-alt-label" value="ti-alt-label"><label for="ti-alt-label">Alternative label</label><br />
          <input type="checkbox" id="ti-definition" name="ti-definition" value="ti-definition"><label for="ti-definition">Definition</label><br />
        </div>
        <div style="grid-row:8; grid-column:1;">
          Deprecation status
        </div>
        <div style="grid-row:8; grid-column:2;">
          <input type="checkbox" id="ds-accepted" name="ds-accepted" value="ds-accepted"><label for="ds-accepted">Accepted</label><br />
          <input type="checkbox" id="ds-deprecated" name="ds-deprecated" value="ds-deprecated"><label for="ds-deprecated">Deprecated</label><br />
        </div>
        <div style="grid-row:9; grid-column:1;">
          <input type="checkbox" id="additional-filter" name="additional-filter" value="additional-filter">
        </div>
        <div style="grid-row:9; grid-column:2;">
          <label for="additional-filter">Additional filter</label>
        </div>
        <div style="grid-row:10; grid-column:1;">
          <label for="per-page">
Results per page</label>
        </div>
        <div style="grid-row:10; grid-column:2;">
          <select name="per-page">
            <option id="ten" value="10">10</option>
            <option id="fifty" value="50" selected>50</option>
            <option id="hundred" value="100">100</option>
            <option id="2hundred" value="200">200</option>
            <option id="5hundred" value="500">500</option>
          </select>
        </div>
        <div style="grid-row:11; grid-column:1/3;">
          <p><strong>Collections library</strong></p>
          <table id="collection-ids-table">
            <tr>
            {% for vocab in vocabs %}
              {% if (loop.index - 1) % 15 == 0 %}
            </tr>
            <tr>
              {% endif %}
              <td class="collection-id-cell-adv"><div style="background-color: {{ c[vocab[0][0]] }};" value="{{ vocab[0] }}" title="{{ vocab[1] }}">{{ vocab[0] }}</div></td>
            {% endfor %}
            </tr>
          </table>
        </div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
    $(document).ready(function() {
      $("#search-form-simple").show();
      $("#search-form-advanced").hide();
      $("#search-form-simple-within").hide();
      $("#search-form-advanced-within").hide();

      $("#so-simple").click(function(event) {
        $("#search-form-simple").show();
        $("#search-form-advanced").hide();
        $("#search-form-simple-within").hide();
        $("#search-form-advanced-within").hide();
        $("#so-simple").addClass("sel");
        $("#so-advanced").removeClass("sel");
        $("#so-simple-within").removeClass("sel");
        $("#so-advanced-within").removeClass("sel");
      });
      $("#so-advanced").click(function(event) {
        $("#search-form-simple").hide();
        $("#search-form-advanced").show();
        $("#search-form-simple-within").hide();
        $("#search-form-advanced-within").hide();
        $("#so-simple").removeClass("sel");
        $("#so-advanced").addClass("sel");
        $("#so-simple-within").removeClass("sel");
        $("#so-advanced-within").removeClass("sel");
      });
      $("#so-simple-within").click(function(event) {
        $("#search-form-simple").hide();
        $("#search-form-advanced").hide();
        $("#search-form-simple-within").show();
        $("#search-form-advanced-within").hide();
        $("#so-simple").removeClass("sel");
        $("#so-advanced").removeClass("sel");
        $("#so-simple-within").addClass("sel");
        $("#so-advanced-within").removeClass("sel");
      });
      $("#so-advanced-within").click(function(event) {
        $("#search-form-simple").hide();
        $("#search-form-advanced").hide();
        $("#search-form-simple-within").hide();
        $("#search-form-advanced-within").show();
        $("#so-simple").removeClass("sel");
        $("#so-advanced").removeClass("sel");
        $("#so-simple-within").removeClass("sel");
        $("#so-advanced-within").addClass("sel");
      });

      $(".collection-id-cell div").click(function(event) {
        $("#search-form-simple-text-collection").val(($(this).html()));
      });

      $(".collection-id-cell-adv div").click(function(event) {
        $("#search-form-advanced-text-collection").val(($(this).html()));
      });

      $("#search-form-simple-submit").click(function(event) {
        var redirect = 'https://www.bodc.ac.uk/resources/vocabularies/vocabulary_search/cvl/';
        $.redirectPost(redirect, {
          "searchstr": $("#search-form-simple-text").val(),
          "identifier": "identifier",
          "preflabel": "preflabel",
          "altlabel": "altlabel",
          "definition": "definition",
          "searchtype": "concepts",
          "resultsPerPage": $('select[name="per-page"]').val(),
          }
        );
      });

      $("#search-form-advanced-submit").click(function(event) {
        var redirect = 'https://www.bodc.ac.uk/resources/vocabularies/vocabulary_search/cvl/';
        var payload = {
          "searchstr": $("#search-form-advanced-text").val(),
          "searchtype": $('input[name="search-type"]:checked').val(),
          "resultsPerPage": $('select[name="per-page-adv"]').val(),
        };
        if ($('#case-sensitive').is(":checked")) {payload["case_sensitive"] = "on";}
        if ($('#exact-match').is(":checked")) {payload["exact"] = "on";}
        if ($('#identifier').is(":checked")) {payload["identifier"] = "identifier";}
        if ($('#pref-label').is(":checked")) {payload["preflabel"] = "preflabel";}
        if ($('#alt-label').is(":checked")) {payload["altlabel"] = "altlabel";}
        if ($('#definition').is(":checked")) {payload["definition"] = "definition";}

        $.redirectPost(redirect, payload);
      });

      /* redirects to NVS search system */
      // jquery extend function
      $.extend({
        redirectPost: function(location, args)
        {
          var form = $('<form></form>');
          form.attr("method", "post");
          form.attr("action", location);

          $.each( args, function( key, value ) {
            var field = $('<input></input>');

            field.attr("type", "hidden");
            field.attr("name", key);
            field.attr("value", value);

            form.append(field);
          });

          $(form).appendTo('body').submit();
        }
      });
    });
    </script>
{% endblock %}